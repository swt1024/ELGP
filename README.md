# ELGP: A computational framework for predicting essential lncRNA genes with lncRNA-protein-protein interaction network and multi-omics data.

In this work, we proposed a framework to identify essential lncRNAs by taking advantage of the topological feature of the lncRNA-protein-protein heterogeneous network and muti-omics features. We used multi-omics features to annotate nodes at lncRNA-protein-protein interaction network and introduced the HinSAGE algorithm to learn node representation for lncRNAs in the lncRNA-protein-protein heterogeneous network. We named this method as ELGP (**E**ssential 
**L**ncRNA **G**ene **P**redictor).

---
## Project Structure

```
ELGP/
├── data/   
│   ├── raw/                    # Data before preprocess
│   ├── preprocess/             # Preprocessing script
│   ├── benchmark/              # Human and mouse benchmark datasets
│   ├── LPI/                    # Human and mouse LPI networks
│   ├── PPI/                    # Human and mouse PPI networks
│   └── LPPI/                   # Human and mouse LPPI networks
├── reference_lncRNA/ 
│   ├── human/                  # Reference data for human lncRNA genes
│   ├── mouse/                  # Reference data for mouse lncRNA genes
│   └── reference_genome/       # Reference genome sequence for human and 
├── process/                    # Data preprocessing scripts
│   ├── benchMarking_human/     # Building the human benchmark dataset
│   ├── benchMarking_mouse/     # Building the mouse benchmark dataset
│   ├── LPI_human/              # Constructing the human LPI network
│   ├── LPI_mouse/              # Constructing the mouse LPI network
│   └── LPPI/                   # Constructing the LPPI network
├── omics/                      # Omics data for node annotation
│   ├── conservation/           # Evolutionary conservation data
│   ├── ENCODE_annotation/      # Epigenomic feature data from ENCODE
│   └── protein/                # Protein-coding gene related data
├── annotate/                   # Scripts for annotating node features
│   ├── human/                  # Annotate node for human LPPI network
│   └── mouse/                  # Annotate node for mouse LPPI network
├── HinSAGE/                    # Training HinSAGE model
├── classifier/                 # Classifier training scripts
│   ├── SVM/                    # SVM-based cross-validation and prediction
│   └── MLP/                    # MLP-based cross-validation and prediction
├── results/                    # Prediction results generated by ELGP
└── experiment/                 # Scripts for experimental procedures
```

---
## Installation 
```
# Clone the repository
git clone https://github.com/swt1024/ELGP.git

# Create and activate conda environment (recommended)
conda create -n ELGP python==3.7
conda activate ELGP

# Install dependencies
conda install -c bioconda bedtools
pip install -r requirements.txt
```
---
## Workflow of ELGP

### 1. Data collection and preprocessing
#### Step1: Download and preprocess the reference lncRNA gene-related data.

1. Download the following files into the corresponding folders:
	`reference_lncRNA/human/gtf`:
	- `lncRNA_LncBookv2.0_GRCh38.gtf` – [Download](https://ngdc.cncb.ac.cn/lncbook/files/lncRNA_LncBookv2.0_GRCh38.gtf.gz)  
	- `NONCODEv5_human_hg38_lncRNA.gtf` – [Download](http://v5.noncode.org/datadownload/NONCODEv5_human_hg38_lncRNA.gtf.gz)  
	- `NONCODEv6_human_hg38_lncRNA.gtf` – [Download](http://www.noncode.org/datadownload/NONCODEv6_human_hg38_lncRNA.gtf.gz)  
	- `ensembl/`: Contains Ensembl GTF files. Multiple Ensembl releases are required, including: `v76`, `v78`, `v80`, `v84`, `v87`, `v93`, `v97`, `v104`, `v106`, `v107`, `v108`, `v109`, `v110`, `v111`, `v112`, `v113`. Example (Release 113): [Homo_sapiens.GRCh38.113.gtf.gz](https://ftp.ensembl.org/pub/release-113/gtf/homo_sapiens/Homo_sapiens.GRCh38.113.gtf.gz) More versions available at: [Ensembl FTP Repository](https://ftp.ensembl.org/pub/)
	`reference_lncRNA/human/bed`:
	- `NONCODEv6_hg38.lncAndGene.bed` – [Download](http://www.noncode.org/datadownload/NONCODEv6_hg38.lncAndGene.bed.gz)  
	- `NONCODEv5_hg38.lncAndGene.bed` – [Download](http://v5.noncode.org/datadownload/NONCODEv5_hg38.lncAndGene.bed.gz)
	
	`reference_lncRNA/mouse/gtf`:
	- `NONCODEv5_mouse_mm10_lncRNA.gtf` – [Download](http://v5.noncode.org/datadownload/NONCODEv5_mouse_mm10_lncRNA.gtf.gz)  
	- `ensembl/`: Contains multiple GTF files from Ensembl (v84–v100). Example (Release 100): [Mus_musculus.GRCm38.100.gtf.gz](https://ftp.ensembl.org/pub/release-100/gtf/mus_musculus/Mus_musculus.GRCm38.100.gtf.gz) More versions available at: [Ensembl FTP Repository](https://ftp.ensembl.org/pub/)
	
	`reference_lncRNA/mouse/bed:
	- `NONCODEv6_mm10.lncAndGene.bed` – [Download](http://www.noncode.org/datadownload/NONCODEv6_mm10.lncAndGene.bed.gz)  
	- `NONCODEv5_mm10.lncAndGene.bed` – [Download](http://v5.noncode.org/datadownload/NONCODEv5_mm10.lncAndGene.bed.gz)
	
	`human/fasta`
	- `LncBookv2_OnlyLnc.fa` – [Download](https://ngdc.cncb.ac.cn/lncbook/files/lncRNA_LncBookv2.0.fa.gz)
	- `NONCODEv6_human.fa` – [Download](http://www.noncode.org/datadownload/NONCODEv6_human.fa.gz)
	- `NONCODEv5_human.fa` – [Download](http://v5.noncode.org/datadownload/NONCODEv5_human.fa.gz)
	- `ensembl/`: Contains human lncRNA FASTA files (ncrna.fa). Multiple Ensembl releases are required, including: `v76`, `v78`, `v80`, `v84`, `v87`, `v93`, `v97`, `v104`, `v106`, `v107`, `v108`, `v109`, `v110`, `v111`, `v112`, `v113`. Example (Release 113): [Homo_sapiens.GRCh38.ncrna.fa.gz](https://ftp.ensembl.org/pub/release-113/fasta/homo_sapiens/ncrna/Homo_sapiens.GRCh38.ncrna.fa.gz) More versions available at: [Ensembl FTP Repository](https://ftp.ensembl.org/pub/)
	
	`mouse/fasta`
	- `NONCODEv5_mouse.fa` – [Download](http://v5.noncode.org/datadownload/NONCODEv5_mouse.fa.gz)
	- `NONCODEv6_mouse.fa` – [Download](http://www.noncode.org/datadownload/NONCODEv6_mouse.fa.gz)
	- `ensembl/`: Contains mouse lncRNA FASTA files (ncrna.fa) from Ensembl v84–v100 . Example (Release 100): [Mus_musculus.GRCm38..ncrna.fa.gz](https://ftp.ensembl.org/pub/release-100/fasta/mus_musculus/ncrna/Mus_musculus.GRCm38.ncrna.fa.gz) More versions available at: [Ensembl FTP Repository](https://ftp.ensembl.org/pub/)
	
	`reference_lncRNA/reference_genome`
	- `GRCh38.p14.genome.fa`  – [Download](https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_human/release_47/GRCh38.p14.genome.fa.gz)
	- `GRCm38.p6.genome.fa`    – [Download](https://ftp.ebi.ac.uk/pub/databases/gencode/Gencode_mouse/release_M25/GRCm38.p6.genome.fa.gz)

2. Run the following command line instructions for preprocessing in the `reference_lncRNA/preprocess/` directory:
	```
	# Generate BED files from LncBook GTF files and preprocess NONCODE BED files
	./pro_bed.sh
	
	# Convert Ensembl GTF files into BED files
	python gtf2bed.py ../human/gtf/ensembl ../human/bed/ensembl
	python gtf2bed.py ../mouse/gtf/ensembl ../mouse/bed/ensembl
	
	# Generate mappings between lncRNA genes and transcripts from GTF files
	python get_trans.py ../human/gtf ../human/transcript
	python get_trans_ensembl.py ../human/gtf/ensembl ../human/transcript/ensmebl
	python get_trans.py ../mouse/gtf ../mouse/transcript
	python get_trans_ensembl.py ../mouse/gtf/ensembl ../mouse/transcript/ensmebl
	
	# Preprocess FASTA files
	python process_fasta.py ../human/fasta ../human/fasta
	python process_fasta.py ../human/fasta/ensembl ../human/fasta/processed_ensembl
	python process_fasta.py ../mouse/fasta ../mouse/fasta
	python process_fasta.py ../mouse/fasta/ensembl ../mouse/fasta/processed_ensembl
	```
#### Step2: Download and preprocess LPI, PPI, and essential lncRNA data.
1. Download the following data to `data/raw`:
	- `esslnc.csv`: Essential lncRNA gene data from the dbEssLnc2.0 database.
	- `lncrna_rbp_LncBook2.0.csv`: Raw human LPI data from the LncBook 2.0 database.  
	  [Download](https://ngdc.cncb.ac.cn/lncbook/files/lncrna_rbp_LncBook2.0.csv.gz)
	- `lncRNA_interaction.txt`: Raw LPI data from the NPInter v5.0 database.  
	  [Download](http://bigdata.ibp.ac.cn/npinter5/download/file/lncRNA_interaction.txt.gz)
	- `BIOGRID-Homo_sapiens-4.4.241.tab3.txt`: PPI data from the BIOGRID database. 
	  [Download shared ZIP](https://downloads.thebiogrid.org/File/BioGRID/Release-Archive/BIOGRID-4.4.241/BIOGRID-ORGANISM-4.4.241.tab3.zip)
	- `BIOGRID-Mus_musculus-4.4.241.tab3.txt`: PPI data from the BIOGRID database.  
	  [Download shared ZIP](https://downloads.thebiogrid.org/File/BioGRID/Release-Archive/BIOGRID-4.4.241/BIOGRID-ORGANISM-4.4.241.tab3.zip)

2. Run `data/preprocess/pro_ess.py` to obtain lncRNA gene essentiality data, outputting `data/benchmark/human/human_esslnc.csv` and `data/benchmark/mouse/mouse_esslnc.csv`.
3. Run `data/preprocess/pro_lncbook.sh` to filter `data/raw/lncrna_rbp_LncBook2.0.csv`, outputting `data/LPI/human/LncBook_LPI.csv`.
4. Run `data/preprocess/pro_NPInter.sh` to filter `data/raw/lncRNA_interaction.txt`, outputting `data/LPI/human/NPInter_LPI.csv` and `data/LPI/mouse/NPInter_LPI.csv`.
5. Run the `correct_human_npinter.py` script to correct the raw human NPInter interaction data. The script uses the following files: 
	- `ProteinNameCorrections.csv`: Contains erroneous protein names and their corresponding valid names. 
	- `Cell_TissueCorrections.csv`: Contains invalid tissue or cell line names along with their valid counterparts.；
6. Run the `correct_mouse_npinter.py` script to correct the raw mouse NPInter interaction data.

#### Step3: Download and preprocess the data used for annotating nodes.
1. Run the `omics/conservation/download.sh` script to download the phylop and phastCons scores for both human and mouse genomes in BigBed format from UCSC.
2. Run the `omics/ENCODE_annotation/download.py` script to download epigenomic peak data in BigBed format from ENCODE for various tissues.  Specific download links can be found in the respective species folder and tissue folder under the `download.sh` file.
3. Run the `omics/protein/human/download.sh` script to download and decompress the pLI score data from gnomAD.
4. Run the `omics/protein/mouse/download.py` script to download mouse gene expression data for multiple tissues from MGI. The script uses the following file:
	- `MGI_filter_conditions.csv`: Contains file names and the corresponding filter conditions for each dataset.
5. Download the `mgi.gaf` file, which contains the Gene Ontology (GO) term annotations for mouse genes. - [Download](https://current.geneontology.org/annotations/mgi.gaf.gz)
6. Run the `filter.py` script to filter the expression data files based on the conditions specified in the `MGI_filter_conditions.csv` file.

### 2. Construct lncRNA-protein-protein heterogeneous network

#### Step1: Construct lncRNA-protein interactions network
**human**
To merge interaction data from the NPInter and LncBook databases:
1. Run the `process/LPI_human/getCoordination.py` script to extract coordinate ranges of lncRNA genes using BED files, outputting - `npinter_lnc_0based.bed` and `lncbook_lnc_0based.bed`. Genes without coordinate information are recorded in `lnc_no_pos.csv`.
2. Run `match_lncRNA.sh` using bedtools to find lncRNA genes with exactly overlapping coordinates, outputting `mapped_lncRNA.txt`.
3. Run `merge_all.py` to merge the interaction data from NPInter and LncBook, output `data/LPI/human/LPI.csv`, `data/LPI/human/lncRNA.csv` and `data/LPI/human/protein.csv`

**mouse**
 1. Run `process/LPI_mouse/getLPI.py` to comstruct LPI network，output `data/LPI/mouse/LPI.csv`, and `data/LPI/mouse/protein.csv`。Genes without coordinate information are recorded in `lnc_no_pos.csv`.

#### Step2: Construct lncRNA-protein-protein interactions network
**human**
 1. Run `process/LPPI_human/getPPI.py` to filter PPI data，output `data/PPI/human/PPI.csv`, and `data/PPI/human/protein_in_ppi.csv`。
 2. Run `process/LPPI_human/getLPPI.py` to construct LPPI network，output `data/LPPI/human/LPPI.csv`, and `data/LPPI/human/protein.csv`。

**mouse**
1. Run `process/LPPI_mouse/getPPI.py` to filter PPI data，output `data/PPI/mouse/PPI.csv` and `data/PPI/mouse/protein_in_ppi.csv`。
2. Run `process/LPPI_mouse/getLPPI.py` to construct LPPI network，output `data/LPPI/mouse/LPPI.csv` and `data/LPPI/mouse/protein.csv`。
3. Run the `correct_protein.py` script to correct the protein name, output `data/LPPI/mouse/LPPI_updated.csv` and `data/LPPI/mouse/protein_updated.csv`. The script uses the following files: 
	- `right_protein.csv`: Contains erroneous protein names and their corresponding valid names. 
### 3. Node feature annotation for the LPPI network

 **human**
1. Run the `annotate/human/lncRNA_feature_annotate.ipynb` notebook to annotate features for all lncRNA nodes in the human LPPI network.
2. Run the `annotate/human/protein_feature_annotate.ipynb` notebook to annotate features for all protein nodes in the human LPPI network.

**mouse**
1. Run the `annotate/mouse/lncRNA_feature_annotate.ipynb` notebook to annotate features for all lncRNA nodes in the mouse LPPI network.
2. Run the `annotate/mouse/protein_feature_annotate.ipynb` notebook to annotate features for all protein nodes in the mouse LPPI network.

### 4. Heterogeneous representation learning

Users can run `./HinSAGE/train.py` to generate the node representation for lncRNA gene nodes , e.g. `HinASGE/human/lncRNA_embeddings_heart.csv`.  The following are the optimal parameters used on the datasets in this study:

| dataset | The number of sampled neighboring nodes | The dimensions of the hidden layers |
| ------- | :-------------------------------------: | :---------------------------------: |
| Human   |                 (20,15)                 |              (64,256)               |
| Mouse   |                 (10,15)                 |              (64,64)                |

**Note:**  
Users can run `./HinSAGE/tune.py` to generate node embeddings for tuning model parameters.  
They can then use the first two code cells in `classifier/SVM/svm.ipynb` to evaluate the model's performance under different parameter settings.
### 5. Construct benchmark dataset
#### Step1: Construct essential lncRNA gene dataset
Run`./process/benchamrk_human/get_ess.py` and `./process/benchamrk_mouse/get_ess.py`to construct essential lncRNA gene dataset for human and mouse. 

#### Step2: Construct non-essential lncRNA gene dataset
**human**
1. Run the `./process/benchmark_human/get_trans.py` script to use the previously generated gene–transcript mappings and extract the transcript information for each lncRNA gene, output `lnc_trans.txt`.
2. Run the `./process/benchmark_human/get_seq.py` script to create a FASTA file containing the transcript sequences: `transcript_sequences.fasta`.  Additionally, it filters out transcripts longer than 20,000 nucleotides and updates the gene–transcript mapping, output `filtered_lnc_trans.txt`.
3. Run the `./process/benchmark_human/cal_MFE.sh` script, using `transcript_sequences.fasta` as input, to compute the minimum free energy (MFE) of each transcript, output `./process/benchmark_human/trans_MFE.csv`.
4. Run the `./process/benchmark_human/cal_GIC.py` script to calculate GIC scores based on `transcript_sequences.fasta` and `trans_MFE.csv`, then sort the results in ascending order, output `./process/benchmark_human/sorted_GIC.csv`.
5. Run the `./process/benchmark_human/get_noness.py` script to select negative samples from the top of the sorted GIC score list, output `data/benchmark/human/noness_lpi.csv`.

**mouse**
To generate the negative sample set for mouse, run the scripts in the `process/benchmark_mouse` directory in the same order.
### 6. Supervised machine learning

#### SVM model

| dataset |  C  | kernel function |
| :-----: | :-: | :-------------: |
|  Human  | 10  |     linear      |
|  Mouse  | 10  |     linear      |

The table above shows the parameters used by the SVM model under different datasets.
For example, users can run the forth code cell in `svm.ipynb`, input `data/benchmark/human/ess_lpi.csv`, `data/benchmark/human/noness_lpi.csv` and `HinASGE/human/lncRNA_embeddings_heart`, and get  accuracy, precision and other 's performance indicators.
Users can run the fifth code cell in `svm.ipynb`, input `data/benchmark/human/ess_lpi.csv`, `data/benchmark/human/noness_lpi.csv` and `HinASGE/human/lncRNA_embeddings_heart.csv`, and get predicted results.
#### MLP model

| dataset | The number of neurons in the hidden layer |
| :-----: | :---------------------------------------: |
|  Human  |                  (64,64)                  |
|  Mouse  |                  (32,32)                  |

The table above shows the parameters used by the MLP model under different datasets.

The prediction results of SVM and MLP will be stored in the `results/human` and `results/mouse` directories. The `results` folder contains the prediction outcomes of SVM and MLP across different tissues. It also includes the intersection of the essential lncRNA genes predicted by the two classifiers for each tissue, as well as the union of essential lncRNA genes predicted across multiple tissues for each species. These results can be used for subsequent experimental analyses, including but not limited to the experiments in `experiment`.